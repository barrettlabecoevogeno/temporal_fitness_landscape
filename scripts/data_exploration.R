##########################################################################################
# Created by Marc-Olivier Beausoleil
# McGill University 
# Created Tuesday, February 12, 2020 
# Why: 
# Requires 
# NOTES: 
##########################################################################################
load('output/bird.data.RData', verbose=TRUE)
source('scripts/custom_PCA.R')
source('scripts/0.1_misc.R')
# Output sample size in all year per species ------------------------------
sample.zi = table(bird.data$Species1, 
                  bird.data$Year)

write.csv(sample.zi,"output/my.sample.size.csv")

# PCA all species together ------------------------------------------------
res.pcabs = vegan::rda(bird.data[,c("MedianBeakLength", "MedianBeakWidth","MedianBeakDepth")],scale = FALSE)
custom_pca(res.pcabs, center=TRUE)

# Scores from PCA ---------------------------------------------------------
r = summary(res.pcabs)

if (pdf) {
  pdf("~/Desktop/pca_Beak_Body.pdf", height =7.5,width = 14)
}
par(mfrow=c(1,1))
slab = 1.5
custom_pca(res.pcabs,
           centered = TRUE,
           # vector.to.colour.col = bird.data$Species1, 
           shape.points = 21,
           # vector.to.colour.pch = bird.data$age,
           size.axis.labels = slab,
           size.label = slab,
           main = "",
           col.arrow = "black",
           col.label = "black",
           vector.names = c("MBL","MBW","MBD"),
           position.text.arrow = 2,
           font.type = 2,
           label.the.arrows = FALSE)
  if (pdf) {
  dev.off()
}

# PCA graph presentation ----------------------------------------------------
if (pdf) {
  pdf("~/Desktop/pca_Beak_Body.pdf", height =7.5,width = 14)
  # png("~/Desktop/pca_Beak_Body.png",res = 400, units = "in", height =6,width = 10, bg = NA)
  
}
par(mfrow=c(1,1))
slab = 1.5
custom_pca(res.pcabs,
           name.pc = c('Beak size\n PC1','Beak shape\n PC2'),
           linex = 4,
           centered = TRUE,
           # vector.to.colour.col = bird.data$Species1, 
           shape.points = 21,
           # vector.to.colour.pch = bird.data$age,
           size.axis.labels = slab,
           size.label = slab,
           main = "",
           col.arrow = "black",
           col.label = "black",
           vector.names = c("Length","Width","Depth"),
           position.text.arrow = 2,
           font.type = 2,
           label.the.arrows = FALSE)
if (pdf) {
  dev.off()
}


# pdf("~/Dropbox/finch_recap/finch_recap_my_dataset/data/bird_data/pca_Beak_Body_dimorphism.pdf", height =7.5,width = 7.5)
if (pdf) {
  pdf("~/Desktop/pca_Beak_Body_dimorphism.pdf", height =7.5,width = 7.5)
}
par(mfrow=c(1,1))
library(ggplot2)
bird.data$age = as.factor(bird.data$age)
plot(bird.data$PC2~bird.data$PC1, 
     xlab = "PC1",
     ylab = "PC2",
     col = c("black","purple")[bird.data$age], 
     bg = c("#FF3030","#9ACD31","#1D90FF","#FF8001")[bird.data$Species1],
     pch = c(21,24)[bird.data$age], type = "n")
points(bird.data$PC2~bird.data$PC1, 
       col = c("black",NA)[bird.data$age],
       bg =  ifelse(bird.data$age=="f",c("#FF3030","#9ACD31","#1D90FF","#FF8001")[bird.data$Species1], NA),
       pch = c(21,24)[bird.data$age])

points(bird.data$PC2~bird.data$PC1, 
       col = c(NA,"red")[bird.data$age], 
       bg = ifelse(bird.data$age=="m",c("#FF3030","#9ACD31","#1D90FF","#FF8001")[bird.data$Species1], NA),
       pch = c(21,24)[bird.data$age])
pc2.avg = bird.data %>% group_by(age, Species1) %>% summarise(avg = mean(PC2))
pc1.avg = bird.data %>% group_by(age, Species1) %>% summarise(avg = mean(PC1))
points(pc1.avg$avg, pc2.avg$avg, 
       col = "black", 
       bg =c("yellow","orange")[pc2.avg$age], 
       pch = 22, cex = 1.5)

dfdf=bird.data 
ggplot(aes(y = PC1, x =Species1 , fill = age), data = dfdf) + 
  geom_violin(aes(colour = dfdf$Species1)) + 
  
  theme_bw()+ theme(panel.grid.major = element_line(linetype = "blank"), 
                    panel.grid.minor = element_line(linetype = "blank"), 
                    axis.text = element_text(size = 12, colour = "black"), 
                    panel.background = element_rect(fill = NA)) +labs(title = "Box plot males females")

ggplot(aes(y = PC2, x =Species1 , fill = age), data = dfdf) + 
  geom_violin(aes(colour = dfdf$Species1)) + 
  
  theme_bw()+ theme(panel.grid.major = element_line(linetype = "blank"), 
                    panel.grid.minor = element_line(linetype = "blank"), 
                    axis.text = element_text(size = 12, colour = "black"), 
                    panel.background = element_rect(fill = NA)) +labs(title = "Box plot males females")

ggplot(aes(y = PC1, x =Species1), data = dfdf) + 
  scale_fill_manual(values = c("fortis"="#FF3030",
                               "fuliginosa"="#9ACD31",
                               "magnirostris"="#1D90FF",
                               "scandens"="#FF8001"))+
  scale_color_manual(values = c("fortis"="#FF3030",
                                "fuliginosa"="#9ACD31",
                                "magnirostris"="#1D90FF",
                                "scandens"="#FF8001"))+
  geom_violin(aes(colour = dfdf$Species1, fill = dfdf$Species1)) + 
  theme_bw()+ theme(panel.grid.major = element_line(linetype = "blank"), 
                    panel.grid.minor = element_line(linetype = "blank"), 
                    axis.text = element_text(size = 12, colour = "black"), 
                    panel.background = element_rect(fill = NA)) +labs(title = "Box plot males females")

sink(file = file.path('output/','sexual.dimorphis.txt'), type=c("output", "message"),
     append = FALSE)
cat('\n# Geospiza scandens --------------------------------------------------\n')
dfdf=bird.data %>% filter(Species1 == "scandens")
dfdf$age = as.factor(dfdf$age)
plot(dfdf$PC1~dfdf$age, main = "scandens")
summary(aov(dfdf$PC1~dfdf$age))
plot(dfdf$PC2~dfdf$age, main = "scandens")
summary(aov(dfdf$PC2~dfdf$age))

cat('\n\n\n# Geospiza fortis --------------------------------------------------\n')
dfdf=bird.data %>% filter(Species1 == "fortis")
dfdf$age = as.factor(dfdf$age)
plot(dfdf$PC1~dfdf$age, main = "fortis")
plot(dfdf$PC2~dfdf$age, main = "fortis")
summary(aov(dfdf$PC1~dfdf$age))
summary(aov(dfdf$PC2~dfdf$age))

cat('\n\n\n# Geospiza magnirostris --------------------------------------------------\n')
dfdf=bird.data %>% filter(Species1 == "magnirostris")
dfdf$age = as.factor(dfdf$age)
plot(dfdf$PC1~dfdf$age, main = "magnirostris")
plot(dfdf$PC2~dfdf$age, main = "magnirostris")
summary(aov(dfdf$PC1~dfdf$age))
summary(aov(dfdf$PC2~dfdf$age))

cat('\n\n\n# Geospiza fuliginosa --------------------------------------------------\n')
dfdf=bird.data %>% filter(Species1 == "fuliginosa")
dfdf$age = as.factor(dfdf$age)
plot(dfdf$PC1~dfdf$age, main = "fuliginosa")
plot(dfdf$PC2~dfdf$age, main = "fuliginosa")
summary(aov(dfdf$PC1~dfdf$age))
summary(aov(dfdf$PC2~dfdf$age))
sink(NULL)
if (pdf) {
  dev.off()
}

# mean --------------------------------------------------------------------
table.sp.mean=bird.data %>% 
  group_by(Species1) %>%        # grouping by species
  distinct(BANDFINAL_Year, .keep_all = TRUE) %>%  # selecting only unique capture ids per year (I'm not allowing birds that have been recapture more then one time in one year)
  dplyr::select(Species1, MedianBeakWidth,MedianBeakLength,MedianBeakDepth)%>%
  dplyr::summarise_each(funs(mean(.),var(.)))
table.sp.mean

table.sp.year = bird.data %>%
  dplyr::group_by(Species1) %>%        # grouping by species
  distinct(BANDFINAL_Year, .keep_all = TRUE) %>%  # selecting only unique capture ids per year (I'm not allowing birds that have been recapture more then one time in one year)
  dplyr::select(Year, Site) %>%       # I'm printing only the species per year! 
  table()                       # mamking a table out of it 
table.sp.year

ch = c(#"y.1999","y.2001","y.2002",
  "y.2003","y.2004","y.2005","y.2006", "y.2007","y.2008","y.2009","y.2010",
  "y.2011","y.2012","y.2013","y.2014", "y.2015","y.2016", "y.2017","y.2018","y.2019")

apply(bird.data[,ch],2,sum)

# So to recap here, try subtracting each species mean PC1 and 2 score from each individuals score, 
# then divide the resulting scores by the standard deviation of new scores, pooled across all species.
test=bird.data %>%
  group_by(Species1) %>% 
  mutate(PC1.mean = mean(PC1)) %>%
  mutate(PC2.mean = mean(PC2)) %>%
  ungroup() %>%
  mutate(PC1.per.sp = (PC1-PC1.mean)/sd(PC1)) %>%
  mutate(PC2.per.sp = (PC2-PC2.mean)/sd(PC2)) %>%
  dplyr::select(Species1, PC1.mean,PC1.per.sp, PC1, PC2.mean,PC2.per.sp, PC2)


abund.year.sp = table(bird.data$Year,bird.data$Species1) %>%  
  as.matrix.data.frame(.) %>%  
  `colnames<-`(c(levels(bird.data$Species1))) %>%  
  `row.names<-`(c(2003:2019))
abund.year = apply(abund.year.sp,1,sum) # vector of the total precipitation in a year
# Look at the order of the levels here bird.data$Species1

t(abund.year.sp)
dim(bird.data)
table(bird.data$age,
      bird.data$Species1,
      bird.data$Year)


# Environmental variables -------------------------------------------------
sum.rainfall = structure(c(337.8, 472.5, 190.2, 155.4, 216.3, 251, 243.7, 680.6, 
                           295.8, 611.2, 604.7, 512.3, 76.3, 239.9), .Names = c("2001-03-03", 
                                                                                "2002-03-01", "2003-02-27", "2004-02-12", "2005-02-01", "2006-02-16", 
                                                                                "2007-02-20", "2008-02-21", "2009-03-18", "2010-02-12", "2011-02-23", 
                                                                                "2012-03-09", "2013-03-28", "2014-02-05"))

df.df = structure(c(2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 
                    2012, 2013, 2014, 190.2, 161.2, 185.9, 165.1, 208.7, 769, 219.2, 
                    502.8, 678.9, 514.4, 246.5, 248.1), .Dim = c(12L, 2L), .Dimnames = list(
                      NULL, c("Year.marco", "sum")))

mean.climated.effect.year = structure(list(Year.marco = c("2003", "2004", "2005", "2006", 
                                                          "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014"),
                                           Month = c(6.52602739726027, 6.51366120218579, 6.52602739726027, 
                                                     6.52602739726027, 6.52602739726027, 6.51366120218579, 6.52602739726027, 
                                                     6.52602739726027, 6.52602739726027, 6.51366120218579, 6.52602739726027, 
                                                     6.52197802197802), 
                                           Mean.Air.Temperature = c(23.8095890410959, 
                                                                    23.7366120218579, 23.7843406593407, 24.6731506849315, 22.7989010989011, 
                                                                    24.5247252747253, 24.7749311294766, 23.7615384615385, 24.3068493150685, 
                                                                    24.6746478873239, 23.5715068493151, 25.1597796143251), 
                                           Min.Air.Temperature = c(21.7602739726027, 
                                                                   21.2409836065574, 21.2884615384615, 21.7098630136986, 20.3871232876712, 
                                                                   22.0129476584022, 22.3556164383562, 21.1722527472527, 21.946301369863, 
                                                                   22.129014084507, 21.2235616438356, 22.6288461538462), 
                                           Max.Air.Temperature = c(26.8901369863014, 
                                                                   26.3590163934426, 26.2432876712329, 27.4564383561644, 25.7348901098901, 
                                                                   27.3302197802198, 27.9381868131868, 26.531043956044, 26.9460273972603, 
                                                                   27.4991525423729, 26.4435616438356, 28.1694214876033), 
                                           Sea.Surface.Temperature = c(23.2369863013699, 
                                                                       22.8491803278689, 23.2893956043956, 24.3676712328767, 22.1679452054795, 
                                                                       24.3745901639344, 24.1980821917808, 23.1445054945055, 23.8032876712329, 
                                                                       24.0626865671642, 22.7684931506849, 24.0763736263736),
                                           Mean.Relative.Humidity = c(86.0630136986301, 
                                                                      87.0191256830601, 85.3516483516484, 84.4657534246575, 86.2527472527473, 
                                                                      84.9010989010989, 83.1432506887052, 90.2857142857143, 86.9698630136986, 
                                                                      85.9464788732394, 85.8493150684932, 88.0828729281768)), 
                                      .Names = c("Year.marco", 
                                                 "Month", "Mean.Air.Temperature", "Min.Air.Temperature", "Max.Air.Temperature", 
                                                 "Sea.Surface.Temperature", "Mean.Relative.Humidity"), 
                                      class = "data.frame", row.names = c(NA, -12L))

mean.climated.effect.year.per.month = structure(list(Year.marco = c("2003", "2003", "2003", "2003", 
                                                                    "2003", "2003", "2003", "2003", "2003", "2003", "2003", "2003", 
                                                                    "2004", "2004", "2004", "2004", "2004", "2004", "2004", "2004", 
                                                                    "2004", "2004", "2004", "2004", "2005", "2005", "2005", "2005", 
                                                                    "2005", "2005", "2005", "2005", "2005", "2005", "2005", "2005", 
                                                                    "2006", "2006", "2006", "2006", "2006", "2006", "2006", "2006", 
                                                                    "2006", "2006", "2006", "2006", "2007", "2007", "2007", "2007", 
                                                                    "2007", "2007", "2007", "2007", "2007", "2007", "2007", "2007", 
                                                                    "2008", "2008", "2008", "2008", "2008", "2008", "2008", "2008", 
                                                                    "2008", "2008", "2008", "2008", "2009", "2009", "2009", "2009", 
                                                                    "2009", "2009", "2009", "2009", "2009", "2009", "2009", "2009", 
                                                                    "2010", "2010", "2010", "2010", "2010", "2010", "2010", "2010", 
                                                                    "2010", "2010", "2010", "2010", "2011", "2011", "2011", "2011", 
                                                                    "2011", "2011", "2011", "2011", "2011", "2011", "2011", "2011", 
                                                                    "2012", "2012", "2012", "2012", "2012", "2012", "2012", "2012", 
                                                                    "2012", "2012", "2012", "2012", "2013", "2013", "2013", "2013", 
                                                                    "2013", "2013", "2013", "2013", "2013", "2013", "2013", "2013", 
                                                                    "2014", "2014", "2014", "2014", "2014", "2014", "2014", "2014", 
                                                                    "2014", "2014", "2014", "2014"), 
                                                     Month = c(1, 2, 3, 4, 5, 6, 
                                                               7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 
                                                               2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 
                                                               10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 
                                                               5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 
                                                               12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 
                                                               7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 
                                                               2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 
                                                               10, 11, 12), 
                                                     Mean.Air.Temperature = c(26.3451612903226, 26.55, 
                                                                              26.8548387096774, 25.1566666666667, 23.2064516129032, 22.4766666666667, 
                                                                              22.0806451612903, 21.3612903225806, 21.1366666666667, 23.0612903225806, 
                                                                              23.0333333333333, 24.6064516129032, 25.6548387096774, 26.4724137931034, 
                                                                              26.7709677419355, 26.13, 23.9677419354839, 22.8633333333333, 
                                                                              21.7387096774194, 20.5612903225806, 21.1733333333333, 21.9290322580645, 
                                                                              23.1366666666667, 24.5645161290323, 25.6, 26.3892857142857, 26.7387096774194, 
                                                                              26.1133333333333, 25.0806451612903, 23.9333333333333, 22.7129032258064, 
                                                                              21.8870967741935, 20.96, 20.8903225806452, 22.2633333333333, 
                                                                              23.01, 25.0806451612903, 26.8678571428571, 26.941935483871, 25.51, 
                                                                              25.458064516129, 24.31, 23.3870967741935, 22.8677419354839, 23.2366666666667, 
                                                                              23.358064516129, 24.2833333333333, 24.9451612903226, 26.3645161290323, 
                                                                              27.2142857142857, 25.9129032258065, 24.8333333333333, 23.5225806451613, 
                                                                              22.1413793103448, 21.3774193548387, 19.7225806451613, 19.97, 
                                                                              19.6129032258065, 21.17, 22.0516129032258, 24.441935483871, 25.5655172413793, 
                                                                              26.5096774193548, 26.5433333333333, 26.0129032258065, 25.1933333333333, 
                                                                              24.0935483870968, 23.3612903225806, 22.8866666666667, 22.8034482758621, 
                                                                              22.9633333333333, 23.8612903225806, 25.62, 26.4357142857143, 
                                                                              26.2967741935484, 26.5533333333333, 26.2322580645161, 25.2133333333333, 
                                                                              23.8516129032258, 23.1548387096774, 22.4965517241379, 23.1903225806452, 
                                                                              23.4633333333333, 24.8612903225806, 26.4, 27.2555555555556, 27.8451612903226, 
                                                                              27.44, 25.6870967741935, 23.8366666666667, 21.0258064516129, 
                                                                              20.4709677419355, 20.3633333333333, 20.4806451612903, 21.57, 
                                                                              23.1548387096774, 25.6387096774194, 26.3607142857143, 26.4774193548387, 
                                                                              26.6, 26.241935483871, 24.8366666666667, 23.4451612903226, 22.1451612903226, 
                                                                              21.81, 22.2193548387097, 22.2033333333333, 23.8451612903226, 
                                                                              25.8870967741935, 26.0137931034483, 27.2806451612903, 26.9, 26.5516129032258, 
                                                                              25.72, 24.0838709677419, 22.4677419354839, 22.35, 21.625, 22.67, 
                                                                              23.5161290322581, 25.5483870967742, 26.2785714285714, 26.8032258064516, 
                                                                              26.3166666666667, 24.5935483870968, 22.7133333333333, 21.5741935483871, 
                                                                              20.7516129032258, 20.77, 21.4677419354839, 22.29, 23.941935483871, 
                                                                              25.6967741935484, 27.3857142857143, 27.4774193548387, 27.5633333333333, 
                                                                              26.8451612903226, 25.5033333333333, 24.3548387096774, 23.4633333333333, 
                                                                              22.42, 22.741935483871, 23.84, 24.73), 
                                                     Min.Air.Temperature = c(24.9193548387097, 
                                                                             23.9821428571429, 23.9967741935484, 22.6233333333333, 20.6193548387097, 
                                                                             19.9333333333333, 20.0387096774194, 19.5967741935484, 19.6833333333333, 
                                                                             21.4290322580645, 21.5466666666667, 22.8645161290323, 22.9290322580645, 
                                                                             23.048275862069, 23.3838709677419, 22.99, 21.2483870967742, 20.96, 
                                                                             19.8451612903226, 18.2870967741935, 18.8466666666667, 19.9645161290323, 
                                                                             20.4933333333333, 22.958064516129, 23.2903225806452, 23.275, 
                                                                             23.5129032258065, 23.0466666666667, 22.1838709677419, 21.7366666666667, 
                                                                             20.5258064516129, 19.8870967741935, 18.51, 18.8548387096774, 
                                                                             20.06, 20.6933333333333, 22.7096774193548, 23.9678571428571, 
                                                                             23.3225806451613, 22.5466666666667, 22.958064516129, 22.4633333333333, 
                                                                             20.4322580645161, 19.0354838709677, 21.4633333333333, 19.9709677419355, 
                                                                             20.3166666666667, 21.5483870967742, 23.4387096774194, 23.5821428571429, 
                                                                             22.2483870967742, 21.9666666666667, 21.3709677419355, 19.6966666666667, 
                                                                             19.3064516129032, 17.8354838709677, 18.03, 17.6032258064516, 
                                                                             19.5366666666667, 20.2645161290323, 22.2064516129032, 22.4413793103448, 
                                                                             22.7806451612903, 23.2566666666667, 23.7741935483871, 23.95, 
                                                                             22.2, 21.0935483870968, 21.0241379310345, 20.1290322580645, 20.475, 
                                                                             20.741935483871, 21.8354838709677, 22.7321428571429, 22.2258064516129, 
                                                                             22.79, 23.9, 23.7766666666667, 22.4645161290323, 21.8225806451613, 
                                                                             20.7266666666667, 21.1741935483871, 21.5633333333333, 23.2741935483871, 
                                                                             24.3774193548387, 24.0037037037037, 24.1709677419355, 23.78, 
                                                                             22.9161290322581, 20.7733333333333, 19.1645161290323, 17.9483870967742, 
                                                                             18.3866666666667, 18.4645161290323, 19.0633333333333, 21.2967741935484, 
                                                                             22.9064516129032, 23.0321428571429, 22.4483870967742, 23.5566666666667, 
                                                                             24.3838709677419, 23.3166666666667, 21.9806451612903, 20.2774193548387, 
                                                                             20.19, 20.1322580645161, 19.48, 21.7161290322581, 23.0677419354839, 
                                                                             22.5034482758621, 23.4, 23.9433333333333, 24.2677419354839, 23.4833333333333, 
                                                                             22.3161290322581, 20.6322580645161, 20.3866666666667, 18.705, 
                                                                             20.58, 21.0677419354839, 24.8677419354839, 22.9821428571429, 
                                                                             23.4290322580645, 23.2366666666667, 21.7483870967742, 20.4733333333333, 
                                                                             19.5774193548387, 18.9709677419355, 18.82, 19.2258064516129, 
                                                                             19.82, 21.6193548387097, 23.5193548387097, 24.1857142857143, 
                                                                             23.3806451612903, 24.23, 24.8645161290323, 23.54, 22.1387096774194, 
                                                                             21.4333333333333, 20.4633333333333, 20.1483870967742, 21.2166666666667, 
                                                                             22.5032258064516), 
                                                     Max.Air.Temperature = c(29.2806451612903, 
                                                                             30.7464285714286, 31.1354838709677, 29.2733333333333, 26.9806451612903, 
                                                                             26.0066666666667, 25.7193548387097, 23.641935483871, 22.9466666666667, 
                                                                             25.3516129032258, 25.1166666666667, 26.7193548387097, 28.2451612903226, 
                                                                             29.951724137931, 30.6096774193548, 29.3866666666667, 26.5290322580645, 
                                                                             25.0966666666667, 23.8612903225806, 22.8, 23.3866666666667, 24.1645161290323, 
                                                                             25.4766666666667, 26.9645161290323, 28.2741935483871, 29.8928571428571, 
                                                                             29.9064516129032, 29.47, 27.9129032258065, 26.0133333333333, 
                                                                             24.6193548387097, 23.7548387096774, 22.9466666666667, 22.7129032258065, 
                                                                             24.27, 25.4258064516129, 27.7645161290323, 30.5642857142857, 
                                                                             31.5806451612903, 29.37, 28.3548387096774, 26.4333333333333, 
                                                                             25.1967741935484, 25.1322580645161, 25.51, 25.8161290322581, 
                                                                             26.6333333333333, 27.3612903225806, 29.4548387096774, 31.4857142857143, 
                                                                             30.5129032258065, 28.6666666666667, 26.4032258064516, 24.9103448275862, 
                                                                             23.6612903225806, 21.9838709677419, 22.1166666666667, 21.9677419354839, 
                                                                             23.47, 24.5935483870968, 27.5354838709677, 29.4586206896552, 
                                                                             30.9677419354839, 30.4733333333333, 28.758064516129, 26.88, 26.0645161290323, 
                                                                             25.2161290322581, 25.0666666666667, 25.3310344827586, 25.3066666666667, 
                                                                             26.8612903225806, 29.46, 30.7464285714286, 31.8806451612903, 
                                                                             31.1133333333333, 29.3709677419355, 27.6366666666667, 25.9193548387097, 
                                                                             25.1129032258065, 24.98, 26.1548387096774, 26.1066666666667, 
                                                                             27.0354838709677, 29.4032258064516, 30.0740740740741, 31.7774193548387, 
                                                                             30.93, 28.6903225806452, 26.62, 23.1806451612903, 22.6774193548387, 
                                                                             22.6833333333333, 22.7645161290323, 24.4133333333333, 25.5677419354839, 
                                                                             28.641935483871, 30.1607142857143, 30.9903225806452, 30.0033333333333, 
                                                                             28.2903225806452, 26.5466666666667, 25.2225806451613, 24.1451612903226, 
                                                                             23.7433333333333, 24.5935483870968, 24.7233333333333, 26.5129032258065, 
                                                                             29.2032258064516, 29.9379310344828, 31.4709677419355, 30.1433333333333, 
                                                                             28.8870967741935, 27.78, 25.9516129032258, 24.5433333333333, 
                                                                             24.64, 25.23, 25.1333333333333, 26.2516129032258, 26.9129032258065, 
                                                                             29.9892857142857, 31.0129032258065, 30.0833333333333, 27.3483870967742, 
                                                                             25.1266666666667, 24.2129032258065, 23.1354838709677, 23.26, 
                                                                             24.2903225806452, 25.07, 27.1516129032258, 29.52, 32.0535714285714, 
                                                                             32.1354838709677, 31.5866666666667, 29.4290322580645, 27.4933333333333, 
                                                                             26.5774193548387, 25.8366666666667, 25.0966666666667, 25.1322580645161, 
                                                                             26.3333333333333, 27.1129032258065), 
                                                     Sea.Surface.Temperature = c(25.9, 
                                                                                 25.7035714285714, 25.8322580645161, 23.5, 21.3129032258065, 21.6266666666667, 
                                                                                 21.7774193548387, 21.5967741935484, 21.4366666666667, 23.2096774193548, 
                                                                                 22.99, 24.0870967741935, 24.5322580645161, 24.4689655172414, 
                                                                                 24.6741935483871, 24.52, 22.6774193548387, 22.2266666666667, 
                                                                                 21.5322580645161, 20.4935483870968, 21.0266666666667, 21.6612903225806, 
                                                                                 22.46, 23.9838709677419, 24.5322580645161, 23.8571428571429, 
                                                                                 25.6045161290323, 24.8733333333333, 24.7516129032258, 23.7666666666667, 
                                                                                 23, 21.8870967741935, 21.0666666666667, 20.9290322580645, 22.38, 
                                                                                 22.83, 24.7290322580645, 26.0321428571429, 25.3064516129032, 
                                                                                 24.71, 24.3838709677419, 24.5166666666667, 23.558064516129, 22.8225806451613, 
                                                                                 23.6233333333333, 23.658064516129, 24.29, 24.9322580645161, 26.1806451612903, 
                                                                                 26.2071428571429, 24.641935483871, 22.5133333333333, 21.8322580645161, 
                                                                                 21.3433333333333, 21.2483870967742, 19.9322580645161, 19.8466666666667, 
                                                                                 19.4290322580645, 21.4466666666667, 21.6709677419355, 23.2806451612903, 
                                                                                 25.3448275862069, 26.2129032258065, 26.81, 26.1290322580645, 
                                                                                 25.4266666666667, 24.4612903225806, 23.258064516129, 23.1233333333333, 
                                                                                 23.058064516129, 23.0933333333333, 22.3903225806452, 24.1225806451613, 
                                                                                 24.9357142857143, 23.3709677419355, 25.5333333333333, 25.7193548387097, 
                                                                                 25.17, 24.2677419354839, 23.6612903225806, 22.6966666666667, 
                                                                                 23.0967741935484, 23.1766666666667, 24.6903225806452, 25.9161290322581, 
                                                                                 26.4814814814815, 26.9870967741935, 26.58, 24.9193548387097, 
                                                                                 22.99, 20.6483870967742, 20.2612903225806, 20.2666666666667, 
                                                                                 20.0903225806452, 20.9233333333333, 22.041935483871, 24.2677419354839, 
                                                                                 26.0535714285714, 25.8096774193548, 26.8466666666667, 25.7645161290323, 
                                                                                 24.5166666666667, 23.1967741935484, 22.1903225806452, 22.1, 21.5064516129032, 
                                                                                 21.2533333333333, 22.3354838709677, 24.0354838709677, 25.4034482758621, 
                                                                                 25.9645161290323, 26.65, 25.9677419354839, 24.9466666666667, 
                                                                                 23.6451612903226, 22.2322580645161, 21.9133333333333, NaN, 21.7933333333333, 
                                                                                 22.1935483870968, 23.3096774193548, 25.3321428571429, 25.7806451612903, 
                                                                                 24.86, 23.3096774193548, 21.6566666666667, 20.8193548387097, 
                                                                                 20.5354838709677, 21.1466666666667, 21.5838709677419, 21.8533333333333, 
                                                                                 23.2322580645161, 24.2709677419355, 25.3821428571429, 25.2774193548387, 
                                                                                 25.6433333333333, 26.7, 25.3066666666667, 23.8741935483871, 22.35, 
                                                                                 21.77, 21.6161290322581, 22.5233333333333, 24.2387096774194), 
                                                     
                                                     Mean.Relative.Humidity = c(84.4838709677419, 84.7857142857143, 
                                                                                83.9032258064516, 85.2666666666667, 86.258064516129, 85.6333333333333, 
                                                                                87.7096774193548, 87.258064516129, 87.3666666666667, 83.9354838709677, 
                                                                                86.9, 89.1612903225806, 88.0645161290323, 85.1724137931034, 
                                                                                83.1935483870968, 86.6666666666667, 88.4838709677419, 89.4666666666667, 
                                                                                88, 88.0645161290323, 87.2, 86.4516129032258, 84.5666666666667, 
                                                                                88.7741935483871, 85.9354838709677, 83.1428571428571, 84.4838709677419, 
                                                                                88.5666666666667, 85.741935483871, 88.7333333333333, 86.7096774193548, 
                                                                                86.0322580645161, 84.8, 84.9354838709677, 81.8333333333333, 
                                                                                83.1, 87.9032258064516, 91.6428571428571, 83.4516129032258, 
                                                                                82.3333333333333, 82.8387096774194, 83.6, 82.6451612903226, 
                                                                                84.1935483870968, 84.8, 83.5161290322581, 82.1, 85.0967741935484, 
                                                                                86.6451612903226, 83.3214285714286, 84.0967741935484, 87.1333333333333, 
                                                                                88.3870967741936, 89.1034482758621, 85.4838709677419, 86.5483870967742, 
                                                                                89.2666666666667, 85.5806451612903, 84.7, 84.741935483871, 
                                                                                85.7741935483871, 86.0689655172414, 85, 86.1666666666667, 
                                                                                86.4193548387097, 84.5333333333333, 85.1290322580645, 85.3870967741936, 
                                                                                85.2333333333333, 83.551724137931, 83.6333333333333, 81.9032258064516, 
                                                                                82.7666666666667, 79.8214285714286, 76.3548387096774, 81.3, 
                                                                                84.7741935483871, 83.7666666666667, 85.4838709677419, 85.5483870967742, 
                                                                                84.3103448275862, 81.8064516129032, 82.3333333333333, 89.1290322580645, 
                                                                                91.3870967741936, 89.962962962963, 91.4193548387097, 92.2666666666667, 
                                                                                93.5161290322581, 91.4666666666667, 93.258064516129, 91.0967741935484, 
                                                                                91.3333333333333, 86.9677419354839, 85.7333333333333, 84.9677419354839, 
                                                                                83.258064516129, 88.8214285714286, 87.3870967741936, 93.7666666666667, 
                                                                                90.741935483871, 91.5666666666667, 91.2258064516129, 83.741935483871, 
                                                                                86.1666666666667, 79.2258064516129, 84.5333333333333, 83.6451612903226, 
                                                                                83.3225806451613, 84.9655172413793, 80.4193548387097, 85.5, 
                                                                                85.9032258064516, 86, 86.0645161290323, 88.6129032258064, 
                                                                                86.8333333333333, 86.8, 88.7333333333333, 88.5483870967742, 
                                                                                88.0322580645161, 85.3928571428571, 84.9354838709677, 83.9666666666667, 
                                                                                85.6774193548387, 87.4, 87.3225806451613, 86.3548387096774, 
                                                                                86.8333333333333, 85.5483870967742, 82.0666666666667, 86.5161290322581, 
                                                                                86.6666666666667, 87.9285714285714, 87.3225806451613, 88.4333333333333, 
                                                                                87.7096774193548, 90.6666666666667, 90.1290322580645, 88.5666666666667, 
                                                                                88.6666666666667, 87.6451612903226, 85.9666666666667, 87.2666666666667
                                                     )), 
                                                .Names = c("Year.marco", "Month", "Mean.Air.Temperature", 
                                                           "Min.Air.Temperature", "Max.Air.Temperature", "Sea.Surface.Temperature", 
                                                           "Mean.Relative.Humidity"), 
                                                class = "data.frame", 
                                                row.names = c(NA, -144L))


# Effort  -----------------------------------------------------------------
effort = structure(list(YEAR = c(2003L, 2003L, 2004L, 2004L, 2005L, 2005L, 
                                 2006L, 2006L, 2007L, 2007L, 2008L, 2008L, 2009L, 2009L, 2010L, 
                                 2010L, 2011L, 2011L, 2012L, 2012L, 2013L, 2013L, 2014L, 2014L), 
                        SITE = structure(c(1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 
                                           1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L), .Label = c("AB", 
                                                                                                               "EG"), class = "factor"), 
                        HOUR = c(35, 36, 40, 140, 42.5, 212, 
                                 22.5, 120, 17.5, 52, 27.5, 56, 20, 132, 70, 300, 42.5, 128, 40, 
                                 120, 70, 128, 65, 104)), .Names = c("YEAR", "SITE", "HOUR"), class = "data.frame", row.names = c(NA, -24L))
effort %>% 
  dplyr::group_by(YEAR) %>% 
  dplyr::summarise(sum.hour = sum(HOUR)) %>% t()

# bird.data$last = apply(bird.data[,ch],1,  function(x) max(which(x==1))) # this command was used to create a new columns with the last instance of capture
plot(bird.data$PC2~c(bird.data$PC1*-1), col = bird.data$Species1)
bird.data[-1*bird.data$PC1>-0.5 & bird.data$PC2>-2 & bird.data$Species1 == "fuliginosa",]

# Saving data -------------------------------------------------------------
save(bird.data,   # The database 
     res.pcabs,   # Beak all species
     sum.rainfall,# Rain 
     mean.climated.effect.year,
     mean.climated.effect.year.per.month, 
     df.df,
     effort, file = "~/Desktop/bird.data.RData")
# write.csv(bird.data,"~/Dropbox/finch_recap/finch_recap_my_dataset/data/bird_data/bird.data.csv")
